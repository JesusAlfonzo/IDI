---
// src/components/Loader.astro
---

<div
  id="loader"
  class="fixed inset-0 z-[9999] flex flex-col items-center justify-center bg-slate-50 transition-all duration-700"
>
  <div class="relative flex items-center justify-center">
    <div class="absolute h-24 w-24 animate-ping rounded-full bg-blue-400/20">
    </div>
    <div
      class="absolute h-32 w-32 animate-pulse rounded-full border-2 border-blue-100"
    >
    </div>

    <svg xmlns="http://www.w3.org/2000/svg" fill="none" class="h-20 w-20 text-blue-600 custom-spin" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" class="opacity-10"/><path fill="currentColor" d="M4 12a8 8 0 0 1 8-8V0C5.373 0 0 5.373 0 12zm2 5.291A7.96 7.96 0 0 1 4 12H0c0 3.042 1.135 5.824 3 7.938z" class="opacity-90"/></svg>

    <div class="absolute h-2 w-2 rounded-full bg-blue-600"></div>
  </div>

  <div class="mt-8 flex flex-col items-center">
    <span class="text-xs font-bold uppercase tracking-[0.3em] text-blue-900/40"
      >Instituto de Inmunología</span
    >
    <h2 class="mt-1 text-xl font-light tracking-widest text-slate-800">
      Cargando <span class="font-bold text-blue-600">IDI</span>
    </h2>
    <div class="mt-4 h-0.5 w-48 overflow-hidden rounded-full bg-slate-200">
      <div class="progress-bar h-full bg-blue-600"></div>
    </div>
  </div>
</div>

<style>
  /* Animación del Spinner */
  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }
  .custom-spin {
    animation: spin 0.8s cubic-bezier(0.4, 0, 0.2, 1) infinite;
  }

  /* Animación de la barra de progreso */
  @keyframes loading-bar {
    0% {
      transform: translateX(-100%);
    }
    100% {
      transform: translateX(100%);
    }
  }
  .progress-bar {
    animation: loading-bar 1.5s infinite ease-in-out;
  }

  /* Efecto de salida */
  .fade-out {
    opacity: 0;
    visibility: hidden;
    filter: blur(10px);
  }

  /* Ocultar scrollbar específicamente durante la carga */
  :global(body.loading) {
    overflow: hidden !important;
  }
</style>

<script>
  document.addEventListener("astro:page-load", () => {
    const loader = document.getElementById("loader");
    const body = document.body;

    if (!loader) return;

    const hasShownLoader = sessionStorage.getItem("idi-loader-shown");

    if (hasShownLoader) {
      loader.style.display = "none";
    } else {
      // Bloqueamos el scroll al iniciar
      body.classList.add("loading");

      setTimeout(() => {
        loader.classList.add("fade-out");

        // Liberamos el scroll justo antes de que termine de desvanecerse
        setTimeout(() => {
          loader.style.display = "none";
          body.classList.remove("loading");
          sessionStorage.setItem("idi-loader-shown", "true");
        }, 700);
      }, 1200); // Un poco más de tiempo para que se aprecie la elegancia
    }
  });
</script>
